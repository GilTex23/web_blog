{% extends "base.html" %}

{% block title %}{{ post.title }} - Учебный Блог{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Post Header -->
    <div class="bg-white rounded-lg shadow-md p-8 mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">{{ post.title }}</h1>

        <div class="flex items-center mb-6 pb-4 border-b">
            {% if post.author_avatar and post.author_avatar != 'default.png' %}
                <img src="{{ url_for('static', filename='avatars/' + post.author_avatar) }}"
                     alt="Аватар автора"
                     class="w-12 h-12 rounded-full object-cover mr-4">
            {% else %}
                <div class="avatar-circle avatar-{{ post.first_letter }} mr-4">
                    {{ post.first_letter }}
                </div>
            {% endif %}
            <div>
                <p class="font-medium text-gray-800">{{ post.author_name }}</p>
                <p class="text-sm text-gray-600">{{ post.formatted_date }}</p>

                <!-- Метка "Редактировано" -->
                {% if post.edited_info.is_edited %}
                    <p class="text-xs text-gray-500 mt-1">
                        <i class="fas fa-edit text-gray-500 mr-1"></i> Редактировано {{ post.edited_info.formatted_date }}
                    </p>
                {% endif %}
            </div>
        </div>

        <div class="text-gray-800 leading-relaxed prose prose-lg">
            {{ post.content|safe }}
        </div>
    </div>

    <!-- Edit Post Button -->
    {% if session.user_id == post.author_id %}
        <div class="mt-6 mb-8 flex justify-center">
            <a href="{{ url_for('edit_post', post_id=post.id) }}"
               class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-6 rounded-md transition duration-200">
                <i class="fas fa-edit mr-2"></i> Редактировать пост
            </a>
        </div>
    {% endif %}

    <!-- Comments Section -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-6">Комментарии</h3>

        <!-- Comment Form -->
        <div class="mb-8 p-4 bg-gray-50 rounded-lg">
            <h4 class="font-medium text-gray-800 mb-3">Оставить комментарий</h4>
            <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}">
                <textarea name="content"
                          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent h-24"
                          placeholder="Напишите ваш комментарий..." required></textarea>
                <button type="submit" class="mt-3 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                    Отправить комментарий
                </button>
            </form>
        </div>

        <!-- Comments List -->
        <div class="space-y-6">
            {% if comments %}
                {% for comment in comments %}
                <div class="pb-6 border-b">
                    <div class="flex items-start mb-3">
                        {% if comment.author_name == 'Гость' %}
                            <div class="avatar-circle avatar-gray mr-3">
                                Г
                            </div>
                        {% else %}
                            {% if comment.author_avatar and comment.author_avatar != 'default.png' %}
                                <img src="{{ url_for('static', filename='avatars/' + comment.author_avatar) }}"
                                     alt="Аватар автора"
                                     class="w-8 h-8 rounded-full object-cover mr-3">
                            {% else %}
                                <div class="avatar-circle avatar-{{ comment.first_letter }} mr-3">
                                    {{ comment.first_letter }}
                                </div>
                            {% endif %}
                        {% endif %}
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <p class="font-medium text-gray-800">{{ comment.author_name }}</p>
                                <p class="text-sm text-gray-600">{{ comment.formatted_date }}</p>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-800">{{ comment.escaped_content|replace('\n', '<br>')|safe }}</p>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-gray-600 text-center py-4">Пока нет комментариев. Будьте первым!</p>
            {% endif %}
        </div>
    </div>

    <div class="mt-6 text-center">
        <a href="{{ url_for('index') }}" class="text-blue-600 hover:text-blue-800 font-medium">
            ← Вернуться к блогу
        </a>
    </div>
</div>
{% endblock %}